# Requirements: Oracle DB Integration

## Overview

Integrate Oracle Database as a supported primary database profile in Spring PetClinic, alongside the existing H2, MySQL, and PostgreSQL profiles. This allows operators to run the application against an enterprise Oracle DB instance using a dedicated Spring profile (`oracle`).

---

## User Stories

### US-1: Oracle Profile Activation
**As a** system operator,
**I want to** start the Spring PetClinic application with `-Dspring-boot.run.profiles=oracle`,
**so that** the application connects to an Oracle Database instance instead of H2/MySQL/PostgreSQL.

**Acceptance Criteria:**
- WHEN the `oracle` Spring profile is active, THEN `spring.datasource.url` resolves to an Oracle JDBC URL (defaulting to `jdbc:oracle:thin:@localhost:1521/petclinic`)
- WHEN the `oracle` profile is active, THEN the application boots successfully and all CRUD operations work against Oracle DB
- IF `ORACLE_URL`, `ORACLE_USER`, or `ORACLE_PASS` environment variables are set, THEN those values override the defaults

### US-2: Oracle Schema Initialization
**As a** developer,
**I want** Oracle-compatible DDL scripts to create the petclinic schema,
**so that** the database is initialized automatically on first run without manual SQL execution.

**Acceptance Criteria:**
- WHEN the `oracle` profile is active, THEN `spring.sql.init.schema-locations` points to `classpath*:db/oracle/schema.sql`
- WHEN the `oracle` profile is active, THEN `spring.sql.init.data-locations` points to `classpath*:db/oracle/data.sql`
- WHEN `schema.sql` is executed on a fresh Oracle schema, THEN all six tables (`vets`, `specialties`, `vet_specialties`, `types`, `owners`, `pets`, `visits`) are created with correct columns, constraints, and indexes
- WHEN `schema.sql` is re-executed on an existing schema, THEN no errors are thrown (idempotent DDL)
- WHEN `data.sql` is executed on a fresh schema, THEN the seed data (6 vets, 3 specialties, 6 types, 10 owners, 13 pets, 4 visits) is inserted
- WHEN `data.sql` is re-executed, THEN no duplicate rows are inserted (idempotent DML)

### US-3: Maven Dependency
**As a** developer,
**I want** the Oracle JDBC driver added to `pom.xml`,
**so that** the Oracle datasource can be created at runtime without manual classpath setup.

**Acceptance Criteria:**
- WHEN the project is built with `./mvnw package`, THEN the Oracle JDBC driver (`ojdbc11`) is included in the runtime classpath
- The Oracle JDBC driver dependency must use `scope=runtime`, consistent with MySQL and PostgreSQL driver declarations

### US-4: Integration Test
**As a** developer,
**I want** an Oracle integration test that mirrors the pattern of `MySqlIntegrationTests`,
**so that** Oracle connectivity and basic functionality can be verified in CI with Docker/Testcontainers.

**Acceptance Criteria:**
- WHEN Docker is available, THEN `OracleIntegrationTests` starts an Oracle Free container via Testcontainers
- WHEN Docker is not available, THEN the Oracle integration test is skipped gracefully
- WHEN the test runs, THEN `VetRepository.findAll()` returns vets and the `/owners/1` endpoint responds with HTTP 200
- The test class must be annotated with `@ActiveProfiles("oracle")`, `@Testcontainers(disabledWithoutDocker = true)`, `@DisabledInNativeImage`, and `@DisabledInAotMode`

### US-5: Documentation Update
**As a** developer,
**I want** the `CLAUDE.md` and database profile table updated to include Oracle,
**so that** team members know how to run the app with Oracle.

**Acceptance Criteria:**
- WHEN a developer reads `CLAUDE.md`, THEN they can find the Oracle run command and JDBC URL
- The database profile table in `CLAUDE.md` must include a row for the `oracle` profile

---

## Technical Constraints

- **Oracle SQL Dialect**: No `CREATE TABLE IF NOT EXISTS` syntax before Oracle 23c — use `EXECUTE IMMEDIATE`-based conditional DDL or PL/SQL blocks for idempotent schema creation
- **Auto-increment**: Use `GENERATED BY DEFAULT AS IDENTITY` (Oracle 12c+) — consistent with PostgreSQL's `GENERATED BY DEFAULT AS IDENTITY`
- **Data types**: Use `NUMBER(4)` for integers and `VARCHAR2(N)` for strings (Oracle-native types); avoid MySQL-specific `INT UNSIGNED` or `engine=InnoDB`
- **Idempotent DML**: Use `MERGE INTO ... USING DUAL ON (...)` for idempotent seed data inserts (Oracle equivalent of `INSERT IGNORE` / `ON CONFLICT DO NOTHING`)
- **Oracle JDBC Driver**: Use `com.oracle.database.jdbc:ojdbc11` from Maven Central (available since Oracle 21c release)
- **Testcontainers image**: Use `gvenzl/oracle-free:latest` (Oracle Database Free edition) for integration tests
- **Spring Boot compatibility**: Spring Boot 3.5.0 + Hibernate 6.x natively supports Oracle dialects — no manual `spring.jpa.database-platform` override needed for Oracle 12c+
- **No-HTTP checkstyle rule**: All URLs in code/config must use `https://` not `http://`
- **Formatter**: Run `./mvnw spring-javaformat:apply` before committing Java source files

---

## Out of Scope

- Oracle RAC (Real Application Clusters) configuration
- Oracle-specific stored procedures or PL/SQL business logic
- Oracle Wallet / mTLS connection configuration
- Docker Compose file changes for Oracle (Oracle Free is large; Testcontainers covers integration testing)
- GraalVM native image support for Oracle (Oracle JDBC has limited AOT support)
